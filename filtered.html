<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Similar channels</title>
</head>
<body>
<style>

    .node {
        stroke: #fff;
        stroke-width: 1.5px;
    }

    .link {
        stroke: #999;
        stroke-opacity: .6;
    }

    .node.fixed {
        fill: #f00;
    }

</style>
<body>
<div id="controls">
    <input v-model="distance_filter" type="range" min="0" max="1" step="0.05"/>
</div>
<div id="sim">

</div>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.17/vue.min.js"></script>
<script>

    var width = 1200;
    var height = 900;

    var controls = new Vue({
        el: '#controls',
        data: {
            distance_filter: 0.9
        }
    });

    var sim = new Sim("div#sim", width, height);

    var graph = {
        "nodes" : [
            {
                "name": "A"
            },
            {
                "name": "B"
            },
            {
                "name": "C"
            },
        ],
        "links" : [
            {
                "distance": 0.70,
                "source": 0,
                "target": 1
            },
            {
                "distance": 0.69,
                "source": 1,
                "target": 2
            },
            {
                "distance": 0.80,
                "source": 2,
                "target": 0
            }
        ]
    };

    controls.$watch('distance_filter', function (newVal, oldVal) {
        console.log(newVal, " -> ", oldVal);
    });

    sim.resetTo(graph.nodes, graph.links);

    function Sim(el, width, height) {
        var radius = 5;
        var distanceScale = 100;

        var svg = d3.select(el).append("svg")
            .attr("width", width)
            .attr("height", height);

        var force = d3.layout.force()
            .charge(-120)
            .friction(0.5)
            .linkDistance(function (d) {
                return distanceScale * d.distance;
            })
            .size([width, height]);

        var nodes = force.nodes();
        var links = force.links();;

        var nodeBind = svg.selectAll(".node");
        var linkBind = svg.selectAll(".link");

        force.on("tick", function () {
            linkBind.attr("x1", function (d) {
                        return d.source.x;
                    })
                    .attr("y1", function (d) {
                        return d.source.y;
                    })
                    .attr("x2", function (d) {
                        return d.target.x;
                    })
                    .attr("y2", function (d) {
                        return d.target.y;
                    });

            nodeBind.attr("cx", function (d) {
                        return d.x = Math.max(radius, Math.min(width - radius, d.x));
                    })
                    .attr("cy", function (d) {
                        return d.y = Math.max(radius, Math.min(height - radius, d.y));
                    });
        });


        function nodeId(d) { return d.name; };
        function linkId(d) { return d.source.name + "-" + d.target.name; }

        this.resetTo = function(newNodes, newLinks) {
            force.stop();

            nodes.splice(0, nodes.length);
            newNodes.forEach(function(node){
                nodes.push(node);
            });

            links.splice(0, links.length);
            newLinks.forEach(function(link){
                links.push(link);
            });

            force.start();

            this.bind();
        };

        this.resetLinksTo = function(newLinks) {
            force.stop();

            links.splice(0, links.length);
            newLinks.forEach(function(link){
                links.push(link);
            });

            force.start();

            this.bind();
        };

        this.bind = function() {
            nodeBind = nodeBind.data(force.nodes(), nodeId);
            nodeBind
                .enter().append("circle")
                .attr("class", "node")
                .attr("r", radius);
            nodeBind.exit().remove();

            linkBind = linkBind.data(force.links(), linkId);
            linkBind.enter().append("line")
                    .attr("class", "link")
                    .style("stroke-width", function (d) {
                        return Math.sqrt(distanceScale * d.distance);
                    });
            linkBind.exit().remove();
        };

        force.start();
    }
</script>
</body>
</html>